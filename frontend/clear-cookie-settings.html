<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clear Cookie Settings</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    .user-list {
      margin: 20px 0;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 4px;
    }
    .user-item {
      padding: 10px;
      margin: 5px 0;
      background: white;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .user-info {
      flex: 1;
    }
    .user-id {
      font-weight: bold;
      color: #333;
    }
    .user-email {
      color: #666;
      font-size: 0.9em;
    }
    button {
      background: #ff6b35;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #e55a2b;
    }
    .settings-list {
      margin: 20px 0;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 4px;
    }
    .setting-item {
      padding: 8px;
      font-family: monospace;
      font-size: 0.9em;
      color: #666;
    }
    .success {
      color: #28a745;
      font-weight: bold;
      margin-top: 10px;
    }
    .info {
      color: #666;
      font-size: 0.9em;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üóëÔ∏è Clear Cookie Settings</h1>
    
    <div id="currentUsers"></div>
    <div id="cookieSettings"></div>
    <div id="message"></div>
  </div>

  <script>
    function getCurrentUsers() {
      const users = [];
      
      // Check customer user
      const customerUser = localStorage.getItem('customer_auth_user');
      if (customerUser) {
        try {
          const user = JSON.parse(customerUser);
          users.push({
            id: user.id,
            email: user.email || user.name || 'N/A',
            type: 'Customer'
          });
        } catch {}
      }
      
      // Check admin user
      const adminUser = localStorage.getItem('auth_user');
      if (adminUser) {
        try {
          const user = JSON.parse(adminUser);
          users.push({
            id: user.id,
            email: user.email || user.username || user.name || 'N/A',
            type: 'Admin'
          });
        } catch {}
      }
      
      return users;
    }
    
    function getCookieSettings() {
      const settings = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('cookie_')) {
          settings.push({
            key: key,
            value: localStorage.getItem(key)
          });
        }
      }
      return settings;
    }
    
    function clearSettingsForUser(userId) {
      const analyticsKey = `cookie_analytics_${userId}`;
      const marketingKey = `cookie_marketing_${userId}`;
      
      let cleared = 0;
      if (localStorage.getItem(analyticsKey) !== null) {
        localStorage.removeItem(analyticsKey);
        cleared++;
      }
      if (localStorage.getItem(marketingKey) !== null) {
        localStorage.removeItem(marketingKey);
        cleared++;
      }
      
      return cleared;
    }
    
    function render() {
      const users = getCurrentUsers();
      const settings = getCookieSettings();
      
      // Render users
      const usersDiv = document.getElementById('currentUsers');
      if (users.length > 0) {
        usersDiv.innerHTML = `
          <h2>üì± Current Users</h2>
          <div class="user-list">
            ${users.map(user => `
              <div class="user-item">
                <div class="user-info">
                  <div class="user-id">${user.id}</div>
                  <div class="user-email">${user.email} (${user.type})</div>
                </div>
                <button onclick="clearUser('${user.id}')">Clear Settings</button>
              </div>
            `).join('')}
          </div>
        `;
      } else {
        usersDiv.innerHTML = '<p class="info">No users found in localStorage.</p>';
      }
      
      // Render cookie settings
      const settingsDiv = document.getElementById('cookieSettings');
      if (settings.length > 0) {
        settingsDiv.innerHTML = `
          <h2>üç™ Cookie Settings</h2>
          <div class="settings-list">
            ${settings.map(s => `
              <div class="setting-item">${s.key}: ${s.value}</div>
            `).join('')}
          </div>
        `;
      } else {
        settingsDiv.innerHTML = '<p class="info">No cookie settings found.</p>';
      }
    }
    
    function clearUser(userId) {
      const cleared = clearSettingsForUser(userId);
      const messageDiv = document.getElementById('message');
      
      if (cleared > 0) {
        messageDiv.innerHTML = `<div class="success">‚úÖ Cleared ${cleared} cookie setting(s) for user ${userId}. Banner should appear on next page load!</div>`;
      } else {
        messageDiv.innerHTML = `<div class="info">‚ÑπÔ∏è No cookie settings found for user ${userId}.</div>`;
      }
      
      // Re-render to show updated settings
      setTimeout(render, 500);
    }
    
    // Initial render
    render();
    
    // Refresh every 2 seconds to catch user changes
    setInterval(render, 2000);
  </script>
</body>
</html>


