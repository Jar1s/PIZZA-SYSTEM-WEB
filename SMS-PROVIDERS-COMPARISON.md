# üì± Porovnanie SMS slu≈æieb a integr√°cia

## Preƒço Twilio nie je povinn√©?

**Twilio je len jedna z mo≈ænost√≠!** M√¥≈æete pou≈æi≈• ak√∫koƒævek SMS slu≈æbu. Syst√©m je navrhnut√Ω tak, aby sa ƒæahko prepol na in√∫ slu≈æbu.

## üîç Porovnanie SMS slu≈æieb

### 1. **Slovensk√© SMS slu≈æby** (Odpor√∫ƒçan√© pre Slovensko)

#### SMS.sk API
- **Web**: [https://www.sms.sk](https://www.sms.sk)
- **Ceny**: ~‚Ç¨0.03-0.05 za SMS na Slovensko
- **V√Ωhody**: 
  - Najni≈æ≈°ie ceny pre slovensk√© ƒç√≠sla
  - R√Ωchle doruƒçenie
  - Podpora v slovenƒçine
- **Nev√Ωhody**: 
  - Len pre slovensk√© ƒç√≠sla
  - Menej funkci√≠ ako Twilio

#### SMS Gate (smsgate.sk) ‚≠ê **NAJLACNEJ≈†IE!**
- **Web**: [https://www.smsgate.sk](https://www.smsgate.sk)
- **Cenn√≠k**: [https://www.smsgate.sk/cennik/](https://www.smsgate.sk/cennik/)
- **API**: [https://www.smsgate.sk/api](https://www.smsgate.sk/api)
- **Ceny**: 
  - Textov√Ω identifik√°tor: **‚Ç¨0.0275 za SMS** (bez DPH)
  - Voliteƒæn√Ω identifik√°tor: **‚Ç¨0.0285 za SMS** (bez DPH)
  - Virtu√°lne ƒç√≠slo: **‚Ç¨0.0330 za SMS** + ‚Ç¨10/mesiac za ƒç√≠slo
- **Minim√°lny kredit**: ‚Ç¨10 (‚Ç¨20 pre virtu√°lne ƒç√≠slo)
- **V√Ωhody**: 
  - **Najni≈æ≈°ia cena** pre slovensk√© ƒç√≠sla (‚Ç¨0.0275)
  - ≈Ωiadne aktivaƒçn√© poplatky
  - Kredit platn√Ω 12 mesiacov
  - Rovnak√° cena do v≈°etk√Ωch SK siet√≠ (T-Com, Orange, O2, 4-ka)
  - API dokument√°cia dostupn√°
  - Podpora Viber spr√°v
- **Nev√Ωhody**: 
  - Len pre slovensk√© ƒç√≠sla
  - Zahraniƒçn√© SMS: ‚Ç¨0.102 za SMS

#### SMS API (smsapi.sk)
- **Web**: [https://www.smsapi.sk](https://www.smsapi.sk)
- **Ceny**: ~‚Ç¨0.04-0.06 za SMS
- **V√Ωhody**: 
  - Jednoduch√° integr√°cia
  - Dobr√° dokument√°cia
- **Nev√Ωhody**: 
  - Len pre slovensk√© ƒç√≠sla

#### Orange SMS Gateway
- **Web**: [https://developer.orange.com](https://developer.orange.com)
- **Ceny**: Podƒæa dohody
- **V√Ωhody**: 
  - Priamo od oper√°tora
  - Veƒæmi spoƒæahliv√©
- **Nev√Ωhody**: 
  - Zlo≈æitej≈°ia registr√°cia
  - Vy≈°≈°ie ceny

### 2. **Medzin√°rodn√© slu≈æby**

#### Twilio
- **Web**: [https://www.twilio.com](https://www.twilio.com)
- **Ceny**: ~$0.05-0.10 za SMS na Slovensko, ~$0.0075 pre USA
- **V√Ωhody**: 
  - Najlep≈°ia dokument√°cia
  - Podpora v≈°etk√Ωch kraj√≠n
  - Bezplatn√Ω √∫ƒçet s kreditom ($15.50)
- **Nev√Ωhody**: 
  - Drah≈°ie pre slovensk√© ƒç√≠sla
  - Potrebujete telef√≥nne ƒç√≠slo (~$1.50/mesiac)

#### MessageBird
- **Web**: [https://www.messagebird.com](https://www.messagebird.com)
- **Ceny**: ~‚Ç¨0.05-0.10 za SMS
- **V√Ωhody**: 
  - Dobr√° dokument√°cia
  - Podpora viacer√Ωch kraj√≠n
- **Nev√Ωhody**: 
  - Drah≈°ie ako slovensk√© slu≈æby

#### Vonage (Nexmo)
- **Web**: [https://www.vonage.com](https://www.vonage.com)
- **Ceny**: ~‚Ç¨0.05 za SMS
- **V√Ωhody**: 
  - Spoƒæahliv√° slu≈æba
  - REST API
- **Nev√Ωhody**: 
  - Menej popul√°rna ako Twilio

## üí∞ Porovnanie cien (pre Slovensko)

| Slu≈æba | Cena za SMS | Mesaƒçn√Ω poplatok | Minim√°lny vklad |
|--------|-------------|-------------------|-----------------|
| **SMS Gate** ‚≠ê | **‚Ç¨0.0275** | ‚Ç¨0 | ‚Ç¨10 |
| **SMS.sk** | ‚Ç¨0.03-0.05 | ‚Ç¨0 | ‚Ç¨10 |
| **SMS API** | ‚Ç¨0.04-0.06 | ‚Ç¨0 | ‚Ç¨5 |
| **Twilio** | $0.05-0.10 | $1.50 (ƒç√≠slo) | $0 (kredit) |
| **MessageBird** | ‚Ç¨0.05-0.10 | ‚Ç¨0 | ‚Ç¨0 |
| **Vonage** | ‚Ç¨0.05 | ‚Ç¨0 | ‚Ç¨0 |

**Odpor√∫ƒçanie:**
- **Pre slovensk√© ƒç√≠sla**: **SMS Gate** (najlacnej≈°ie - ‚Ç¨0.0275 za SMS) ‚≠ê
- **Pre medzin√°rodn√©**: Twilio alebo MessageBird
- **Pre testovanie**: Twilio (bezplatn√Ω kredit) alebo SMS Gate (‚Ç¨10 kredit)

## üîß Ako integrova≈• in√∫ slu≈æbu

üìñ **Praktick√Ω pr√≠klad k√≥du**: Pozri `backend/src/auth/sms.service.example.ts` - obsahuje kompletn√∫ implement√°ciu pre r√¥zne slu≈æby.

### Krok 1: Vyberte slu≈æbu

**Odpor√∫ƒçame SMS Gate** pre slovensk√© ƒç√≠sla - **najlacnej≈°ia cena** (‚Ç¨0.0275 za SMS bez DPH).

Alternat√≠vy:
- **SMS.sk** - ~‚Ç¨0.03-0.05 za SMS
- **SMS API** - ~‚Ç¨0.04-0.06 za SMS

### Krok 2: Z√≠skajte API kƒæ√∫ƒç

1. Zaregistrujte sa na vybranej slu≈æbe
2. Vytvorte API projekt
3. Skop√≠rujte API kƒæ√∫ƒç

### Krok 3: Upravte k√≥d

Upravte s√∫bor `backend/src/auth/sms.service.ts`:

#### Pr√≠klad 1: SMS Gate API ‚≠ê (Najlacnej≈°ie)

```typescript
private async sendSmsViaSmsGate(phone: string, code: string): Promise<void> {
  const formattedPhone = this.formatPhoneNumber(phone);
  
  // Odstr√°≈àte + z telef√≥nneho ƒç√≠sla (SMS Gate potrebuje len ƒç√≠sla)
  const phoneWithoutPlus = formattedPhone.replace('+', '');
  
  try {
    // SMS Gate API endpoint (skontrolujte dokument√°ciu na smsgate.sk/api)
    const response = await fetch('https://api.smsgate.sk/send', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${process.env.SMSGATE_API_KEY}`,
      },
      body: JSON.stringify({
        phone: phoneWithoutPlus,
        message: `Vas overovaci kod je: ${code}. Platny 10 minut.`,
        sender: process.env.SMSGATE_SENDER || 'SMSGATE.sk', // alebo vlastn√Ω identifik√°tor
      }),
    });
    
    const data = await response.json();
    
    if (!response.ok || data.error) {
      throw new Error(data.error || `SMS Gate API error: ${response.statusText}`);
    }
    
    this.logger.log(`‚úÖ SMS verification code sent via SMS Gate to ${formattedPhone}`);
  } catch (error: any) {
    this.logger.error(`‚ùå Failed to send SMS via SMS Gate:`, error);
    throw new BadRequestException('Failed to send SMS verification code');
  }
}
```

**Environment premenn√©:**
```bash
SMSGATE_API_KEY=your_api_key_here
SMSGATE_SENDER=PornoPizza  # Voliteƒæn√Ω identifik√°tor (max 11 znakov)
```

**Ceny:**
- Textov√Ω identifik√°tor (SMSGATE.sk): ‚Ç¨0.0275 za SMS
- Voliteƒæn√Ω identifik√°tor: ‚Ç¨0.0285 za SMS
- Minim√°lny kredit: ‚Ç¨10

#### Pr√≠klad 2: SMS.sk API

```typescript
private async sendSms(phone: string, code: string): Promise<void> {
  const formattedPhone = this.formatPhoneNumber(phone);
  
  // SMS.sk API (pre slovensk√© ƒç√≠sla)
  if (process.env.SMS_SK_API_KEY) {
    try {
      const response = await fetch('https://api.sms.sk/api/send', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${process.env.SMS_SK_API_KEY}`,
        },
        body: JSON.stringify({
          phone: formattedPhone,
          message: `Vas overovaci kod je: ${code}. Platny 10 minut.`,
          sender: process.env.SMS_SK_SENDER || 'PornoPizza',
        }),
      });
      
      if (!response.ok) {
        throw new Error(`SMS.sk API error: ${response.statusText}`);
      }
      
      this.logger.log(`SMS verification code sent via SMS.sk to ${formattedPhone}`);
      return;
    } catch (error: any) {
      this.logger.error(`Failed to send SMS via SMS.sk:`, error);
      throw new BadRequestException('Failed to send SMS verification code');
    }
  }
  
  // Twilio (p√¥vodn√° implement√°cia)
  if (process.env.TWILIO_ACCOUNT_SID && process.env.TWILIO_AUTH_TOKEN) {
    // ... existuj√∫ci Twilio k√≥d
    return;
  }
  
  // Fallback: DEV mode
  this.logger.log(`[DEV MODE] SMS Verification Code for ${formattedPhone}: ${code}`);
}
```

#### Pr√≠klad 2: MessageBird

```typescript
// Najprv nain≈°talujte: npm install messagebird
private async sendSms(phone: string, code: string): Promise<void> {
  const formattedPhone = this.formatPhoneNumber(phone);
  
  // MessageBird
  if (process.env.MESSAGEBIRD_API_KEY) {
    try {
      const messagebird = require('messagebird')(process.env.MESSAGEBIRD_API_KEY);
      
      await messagebird.messages.create({
        originator: process.env.MESSAGEBIRD_ORIGINATOR || 'PornoPizza',
        recipients: [formattedPhone],
        body: `Your verification code is: ${code}. Valid for 10 minutes.`,
      });
      
      this.logger.log(`SMS verification code sent via MessageBird to ${formattedPhone}`);
      return;
    } catch (error: any) {
      this.logger.error(`Failed to send SMS via MessageBird:`, error);
      throw new BadRequestException('Failed to send SMS verification code');
    }
  }
  
  // Twilio (fallback)
  if (process.env.TWILIO_ACCOUNT_SID && process.env.TWILIO_AUTH_TOKEN) {
    // ... existuj√∫ci Twilio k√≥d
    return;
  }
  
  // Fallback: DEV mode
  this.logger.log(`[DEV MODE] SMS Verification Code for ${formattedPhone}: ${code}`);
}
```

#### Pr√≠klad 3: Vonage (Nexmo)

```typescript
// Najprv nain≈°talujte: npm install @vonage/server-sdk
private async sendSms(phone: string, code: string): Promise<void> {
  const formattedPhone = this.formatPhoneNumber(phone);
  
  // Vonage (Nexmo)
  if (process.env.VONAGE_API_KEY && process.env.VONAGE_API_SECRET) {
    try {
      const { Vonage } = require('@vonage/server-sdk');
      const vonage = new Vonage({
        apiKey: process.env.VONAGE_API_KEY,
        apiSecret: process.env.VONAGE_API_SECRET,
      });
      
      await vonage.sms.send({
        to: formattedPhone,
        from: process.env.VONAGE_FROM_NUMBER || 'PornoPizza',
        text: `Your verification code is: ${code}. Valid for 10 minutes.`,
      });
      
      this.logger.log(`SMS verification code sent via Vonage to ${formattedPhone}`);
      return;
    } catch (error: any) {
      this.logger.error(`Failed to send SMS via Vonage:`, error);
      throw new BadRequestException('Failed to send SMS verification code');
    }
  }
  
  // Twilio (fallback)
  if (process.env.TWILIO_ACCOUNT_SID && process.env.TWILIO_AUTH_TOKEN) {
    // ... existuj√∫ci Twilio k√≥d
    return;
  }
  
  // Fallback: DEV mode
  this.logger.log(`[DEV MODE] SMS Verification Code for ${formattedPhone}: ${code}`);
}
```

### Krok 4: Nastavte environment premenn√©

Pridajte do `.env` v `backend/`:

```bash
# Pre SMS.sk
SMS_SK_API_KEY=your_api_key_here
SMS_SK_SENDER=PornoPizza

# Pre MessageBird
MESSAGEBIRD_API_KEY=your_api_key_here
MESSAGEBIRD_ORIGINATOR=PornoPizza

# Pre Vonage
VONAGE_API_KEY=your_api_key_here
VONAGE_API_SECRET=your_api_secret_here
VONAGE_FROM_NUMBER=+421XXXXXXXXX
```

### Krok 5: Re≈°tartujte backend

```bash
cd backend
npm run start:dev
```

## üéØ Odpor√∫ƒçan√° konfigur√°cia

### Pre slovensk√© ƒç√≠sla (najlacnej≈°ie):

1. **Pou≈æite SMS.sk alebo SMS API**
2. **Cena**: ~‚Ç¨0.03-0.05 za SMS
3. **Integr√°cia**: Jednoduch√° REST API

### Pre medzin√°rodn√© ƒç√≠sla:

1. **Pou≈æite Twilio alebo MessageBird**
2. **Cena**: ~$0.05-0.10 za SMS
3. **Integr√°cia**: SDK alebo REST API

### Pre testovanie:

1. **Pou≈æite Twilio** (bezplatn√Ω kredit $15.50)
2. **Alebo**: Nechajte pr√°zdne (DEV mode - k√≥d v konzole)

## üìù Kompletn√Ω pr√≠klad: SMS.sk integr√°cia

Tu je kompletn√Ω pr√≠klad integr√°cie SMS.sk:

```typescript
// backend/src/auth/sms.service.ts
private async sendSms(phone: string, code: string): Promise<void> {
  const formattedPhone = this.formatPhoneNumber(phone);
  
  // SMS.sk API (priorita 1 - najlacnej≈°ie pre Slovensko)
  if (process.env.SMS_SK_API_KEY) {
    try {
      // Odstr√°≈àte + z telef√≥nneho ƒç√≠sla pre SMS.sk (potrebuj√∫ len ƒç√≠sla)
      const phoneWithoutPlus = formattedPhone.replace('+', '');
      
      const response = await fetch('https://api.sms.sk/api/send', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${process.env.SMS_SK_API_KEY}`,
        },
        body: JSON.stringify({
          phone: phoneWithoutPlus,
          message: `Vas overovaci kod je: ${code}. Platny 10 minut.`,
          sender: process.env.SMS_SK_SENDER || 'PornoPizza',
        }),
      });
      
      const data = await response.json();
      
      if (!response.ok || data.error) {
        throw new Error(data.error || `SMS.sk API error: ${response.statusText}`);
      }
      
      this.logger.log(`‚úÖ SMS verification code sent via SMS.sk to ${formattedPhone}`);
      return;
    } catch (error: any) {
      this.logger.error(`‚ùå Failed to send SMS via SMS.sk:`, error);
      // Fallback na Twilio ak SMS.sk zlyh√°
    }
  }
  
  // Twilio (fallback alebo pre medzin√°rodn√© ƒç√≠sla)
  if (process.env.TWILIO_ACCOUNT_SID && process.env.TWILIO_AUTH_TOKEN) {
    try {
      const twilio = require('twilio');
      const client = twilio(
        process.env.TWILIO_ACCOUNT_SID,
        process.env.TWILIO_AUTH_TOKEN
      );

      await client.messages.create({
        body: `Your verification code is: ${code}. Valid for 10 minutes.`,
        from: process.env.TWILIO_PHONE_NUMBER,
        to: formattedPhone,
      });

      this.logger.log(`‚úÖ SMS verification code sent via Twilio to ${formattedPhone}`);
      return;
    } catch (error: any) {
      this.logger.error(`‚ùå Failed to send SMS via Twilio:`, error);
      // Fallback na DEV mode
    }
  }
  
  // Fallback: DEV mode (log do konzoly)
  this.logger.log(`[DEV MODE] SMS Verification Code for ${formattedPhone}: ${code}`);
  this.logger.warn(`‚ö†Ô∏è  No SMS provider configured. Code logged above.`);
}
```

## ‚úÖ V√Ωhody tejto implement√°cie

1. **Flexibilita**: M√¥≈æete pou≈æi≈• ak√∫koƒævek slu≈æbu
2. **Fallback**: Ak jedna slu≈æba zlyh√°, pou≈æije sa in√°
3. **Ceny**: M√¥≈æete zvoli≈• najlacnej≈°iu slu≈æbu
4. **Lokaliz√°cia**: M√¥≈æete pou≈æi≈• slovensk√© slu≈æby pre slovensk√© ƒç√≠sla

## üöÄ R√Ωchly ≈°tart s SMS.sk

1. Zaregistrujte sa na [sms.sk](https://www.sms.sk)
2. Vytvorte API kƒæ√∫ƒç
3. Pridajte do `.env`:
   ```bash
   SMS_SK_API_KEY=your_api_key_here
   SMS_SK_SENDER=PornoPizza
   ```
4. Upravte `sms.service.ts` podƒæa pr√≠kladu vy≈°≈°ie
5. Re≈°tartujte backend

**Hotovo!** Teraz pou≈æ√≠vate najlacnej≈°iu slu≈æbu pre Slovensko. üéâ

